---
- name: Install Nginx, MySQL, PHP packages
  apt:
    name:
      - nginx
      - mysql-server
      - php-fpm
      - php-mysql
      state: present
      update_cache: yes
      - name: Ensure nginx is running
        service:
          name: nginx
          state: started
          enabled: yes

      - name: Ensure PHP-FPM is running
        service:
          name: php7.4-fpm
          state: started
          enabled: yes

      - name: Deploy PHP index file using template
        template:
          src: index.php.j2
          dest: /var/www/html/index.php
          owner: www-data
          group: www-data
          mode: '0644'
          notify:
            - Reload nginx
